;; Kanata Configuration for VS Code Power User
;; Features: Space-Hold Nav Layer, Blank Line Jumps, Call Hierarchy, and Smart Search

(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)
(deftemplate text-paste (text)
 (macro
  (clipboard-save 0)
  (clipboard-set $text)
  C-v
  200
  (clipboard-restore 0)
 ))
(defalias
  ;; --- NAVIGATION MACROS ---
  ;; Universal 'o': Go to End, then hit Enter (Vim 'o')
  vim_o (macro end ret)

  ;; Code Awareness
  call_h S-A-h    ;; Space + 2: Call Hierarchy
  pk_ref S-f12    ;; Space + 3: Peek References

  ;; Paragraph/Blank Line Navigation (Requires VS Code Keybindings)
  blnk_up C-S-[ 
  blnk_dn C-S-]

  ;; Smart Selection Shortcuts
  sel_i S-A-right  ;; Expand Selection
  sel_o S-A-left   ;; Shrink Selection

  ;; --- FILE VSCODE NAVIGATION ---
  qk_op C-p        ;; Quick Open file (P)
  go_ln C-g        ;; Go to Line (G)
  nav_bk A-left    ;; Navigate Back (H)
  nav_fw A-right   ;; Navigate Forward (J)
  go_top C-home    ;; Go to file start (U)
  go_bot C-end     ;; Go to file end (I)
  go_def f12       ;; Go to Definition (Y)

  ;; --- SEARCH TAP DANCE ---
  ;; 1 tap: Global Search (Ctrl+Shift+F)
  ;; 2 taps: Focus Explorer + Search (Ctrl+Shift+E -> Ctrl+Alt+F)
  f_dns (tap-dance 200 (
    (multi lctl lsft f)
    (macro C-S-e C-A-f)
  ))

  ;; --- CORE FUNCTIONS ---
  rel lrld  ;; Live Reload Kanata config
  
  ;; Space as Tap-Hold: Tap for Space, Hold for vscode_nav layer
  sp_v (tap-hold-release 200 200 spc (layer-toggle vscode_nav))



  shrug (t! text-paste "¯\_(ツ)_/¯")
)

(deflayer base
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           @sp_v          ralt rmet rctl
)

  ;; ╔═══════════════════════════════════════════════════════════════════════════════════════════╗
  ;; ║                                VSCODE_NAV LAYER LAYOUT                                    ║
  ;; ║                              (Hold Space to activate)                                     ║
  ;; ╠═══════════════════════════════════════════════════════════════════════════════════════════╣
  ;; ║                                                                                           ║
  ;; ║  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐    ║
  ;; ║  │     │ CALL│ PEEK│     │     │     │     │     │     │     │SHRUG│     │     │     │    ║
  ;; ║  │ (`) │HIER │ REF │ (3) │ (4) │ (5) │ (6) │ (7) │ (8) │ (9) │ ¯\_ │ (-) │ (=) │BKSP │    ║
  ;; ║  │     │ (1) │ (2) │     │     │     │     │     │     │     │ (0) │     │     │     │    ║
  ;; ║  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    ║
  ;; ║  │     │BLANK│BLANK│     │     │     │GO TO│FILE │FILE │ VIM │QUICK│     │     │     │    ║
  ;; ║  │(TAB)│  ↑  │  ↓  │ (E) │ (R) │ (T) │ DEF │ TOP │ END │  O  │OPEN │ ([) │ (]) │ (\) │    ║
  ;; ║  │     │ (Q) │ (W) │     │     │     │ (Y) │ (U) │ (I) │ (O) │ (P) │     │     │     │    ║
  ;; ║  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤    ║
  ;; ║  │     │ SEL │ SEL │     │SRCH │ GO  │     │     │     │     │     │     │     │          ║
  ;; ║  │CAPS │SHRNK│ EXP │ (D) │ TAP │LINE │ (H) │ (J) │ (K) │ (L) │ (;) │ (') │ ENTER       │  ║
  ;; ║  │     │ (A) │ (S) │     │ (F) │ (G) │     │     │     │     │     │     │             │  ║
  ;; ║  ├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┴─────────────┤  ║
  ;; ║  │     │ NAV │ NAV │     │     │     │     │     │     │     │     │                   │  ║
  ;; ║  │SHIFT│  ←  │  →  │ (C) │ (V) │ (B) │ (N) │ (M) │ (,) │ (.) │ (/) │      RSHIFT       │  ║
  ;; ║  │     │ (Z) │ (X) │     │     │     │     │     │     │     │     │                   │  ║
  ;; ║  └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴───────────────────┘  ║
  ;; ║       ┌─────┬─────┬─────┐              ┌─────┐              ┌─────┬─────┬─────┐           ║
  ;; ║       │     │     │     │              │[HOLD│              │     │     │RLOAD│           ║
  ;; ║       │CTRL │ WIN │ ALT │              │SPACE│              │RALT │RWIN │ CFG │           ║
  ;; ║       └─────┴─────┴─────┘              └─────┘              └─────┴─────┴─────┘           ║
  ;; ║                                                                                           ║
  ;; ║  LEFT HAND: Code Actions                          RIGHT HAND: Mouse                       ║
  ;; ╚═══════════════════════════════════════════════════════════════════════════════════════════╝
(deflayer vscode_nav
  _    @call_h @pk_ref _      _      _      _       _       _       _      @shrug _    _    _
  _    @blnk_up @blnk_dn _    _      _      @go_def @go_top @go_bot @vim_o @qk_op _    _    _
  _    @sel_o @sel_i _        @f_dns @go_ln _       _       _       _      _      _    _
  _    @nav_bk @nav_fw _      _      _      _       _       _       _      _      _
  _    _    _                 _                     _       _       @rel
)